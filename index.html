<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Liste des joueurs</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    input, button {
      padding: 8px;
      margin: 5px 0;
    }
    ul {
      list-style-type: none;
      padding: 0;
    }
    li {
      margin: 10px 0;
    }
    .player-entry {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .clickable-date {
      cursor: pointer;
      color: blue;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h2>Ajouter un joueur</h2>
  <input type="text" id="playerName" placeholder="Nom du joueur">
  <button onclick="addPlayer()">Ajouter</button>

  <h2>Liste des joueurs</h2>
  <ul id="playerList"></ul>

  <script>
    const API_URL = 'COLLE_ICI_TA_URL_DÉPLOIEMENT'; // <- Remplace par ton URL Apps Script

    const playerList = document.getElementById('playerList');
    const players = {};

    function formatDate(date) {
      return date.toISOString().split('T')[0];
    }

    function addMonth(date) {
      const newDate = new Date(date);
      newDate.setMonth(newDate.getMonth() + 1);
      return newDate;
    }

    function fetchPlayers() {
      fetch(API_URL)
        .then(res => res.json())
        .then(data => {
          playerList.innerHTML = '';
          data.forEach(player => {
            players[player.name] = {
              date: new Date(player.date),
              clicks: parseInt(player.clicks)
            };
            renderPlayer(player.name);
          });
        });
    }

    function renderPlayer(name) {
      const li = document.createElement('li');
      li.classList.add('player-entry');

      const nameSpan = document.createElement('span');
      nameSpan.textContent = name;

      const dateSpan = document.createElement('span');
      dateSpan.className = 'clickable-date';
      dateSpan.textContent = formatDate(players[name].date);
      dateSpan.onclick = () => {
        const newDate = addMonth(new Date());
        players[name].date = newDate;
        players[name].clicks += 1;

        dateSpan.textContent = formatDate(newDate);
        countSpan.textContent = `Clicks: ${players[name].clicks}`;

        savePlayer(name, formatDate(newDate), players[name].clicks);
      };

      const countSpan = document.createElement('span');
      countSpan.textContent = `Clicks: ${players[name].clicks}`;

      li.appendChild(nameSpan);
      li.appendChild(dateSpan);
      li.appendChild(countSpan);

      playerList.appendChild(li);
    }

    function addPlayer() {
      const nameInput = document.getElementById('playerName');
      const name = nameInput.value.trim();
      if (!name || players[name]) return;

      const now = new Date();
      const expiration = addMonth(now);
      players[name] = {
        date: expiration,
        clicks: 0
      };

      renderPlayer(name);
      savePlayer(name, formatDate(expiration), 0);
      nameInput.value = '';
    }

    function savePlayer(name, date, clicks) {
      fetch(API_URL, {
        method: 'POST',
        body: JSON.stringify({ name, date, clicks }),
        headers: {
          'Content-Type': 'application/json'
        }
      });
    }

    // Charger les données à l'ouverture
    fetchPlayers();
  </script>
</body>
</html>
